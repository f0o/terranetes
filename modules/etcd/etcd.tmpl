{"apiVersion":"v1","kind":"Pod","metadata":{"annotations":{"scheduler.alpha.kubernetes.io/critical-pod":""},"labels":{"app":"etcd","tier":"control-plane","heritage":"terranetes"},"name":"etcd","namespace":"kube-system"},"spec":{"containers":[{"command":["/bin/sh","-c"],"args":["${state == "existing" ? "etcdctl --ca-file /etc/etcd/ca.crt --cert-file /etc/etcd/etcd.crt --key-file /etc/etcd/etcd.key --endpoints https://${network.api}:2379 member add etcd-$${HOSTNAME_CLOUD} https://$${HOST_IP}:2380;" : ""} etcd --name=etcd-$${HOSTNAME_CLOUD} --data-dir=/var/lib/etcd --listen-peer-urls=https://$${HOST_IP}:2380 --listen-client-urls=https://$${HOST_IP}:2379 --listen-metrics-urls=http://127.0.0.1:2378 --initial-advertise-peer-urls=https://$${HOST_IP}:2380 --advertise-client-urls=https://$${HOST_IP}:2379 --cert-file=/etc/etcd/etcd.crt --key-file=/etc/etcd/etcd.key --trusted-ca-file=/etc/etcd/ca.crt --peer-cert-file=/etc/etcd/etcd.crt --peer-key-file=/etc/etcd/etcd.key --peer-trusted-ca-file=/etc/etcd/ca.crt --client-cert-auth=true --peer-client-cert-auth=true ${etcd.discovery == "static" ? "--initial-cluster=${cluster} --initial-cluster-token=${token} --initial-cluster-state=${state}" : "--discovery=${etcd.discovery}"}"],"image":"${etcd.image}","livenessProbe":{"tcpSocket":{"host":"127.0.0.1","port":2378},"timeoutSeconds":15},"readinessProbe":{"exec":{"command":["etcdctl","--cert-file","/etc/etcd/etcd.crt","--key-file","/etc/etcd/etcd.key","--ca-file","/etc/etcd/ca.crt","--endpoints","https://$${HOST_IP}:2379","cluster-health"]},"timeoutSeconds":30},"name":"etcd","securityContext":{"privileged":true},"volumeMounts":[{"mountPath":"/etc/etcd/","name":"config","readOnly":true},{"mountPath":"/etc/ssl/","name":"ssl","readOnly":true},{"mountPath":"/var/lib/etcd/","name":"data"}],"workingDir":"/var/lib/etcd"}],"hostNetwork":true,"priorityClassName":"system-node-critical","restartPolicy":"Always","volumes":[{"hostPath":{"path":"/etc/etcd/"},"name":"config"},{"hostPath":{"path":"/etc/ssl/"},"name":"ssl"},{"hostPath":{"path":"/var/lib/etcd"},"name":"data"}]}}